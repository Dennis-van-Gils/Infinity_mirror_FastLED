#include "FastLED.h"
#include "LEDStripConfig.h"
#include <Arduino.h>

FASTLED_USING_NAMESPACE

#if defined(FASTLED_VERSION) && (FASTLED_VERSION < 3001000)
#  warning "Requires FastLED 3.1 or later; check github for latest code."
#endif

#define BRIGHTNESS 180
#define Ser Serial

const uint16_t CRGB_SIZE_N = sizeof(CRGB) * LEDStripConfig::N;
CRGB leds[LEDStripConfig::N];

void setup() {
  Ser.begin(9600);

  // Ensure a minimum delay for recovery of FastLED
  delay(3000);

  FastLED
      .addLeds<LEDStripConfig::LED_TYPE, LEDStripConfig::PIN_DATA,
               LEDStripConfig::PIN_CLK, LEDStripConfig::COLOR_ORDER,
               DATA_RATE_MHZ(1)>(leds, LEDStripConfig::N)
      .setCorrection(LEDStripConfig::COLOR_CORRECTION);
  FastLED.setBrightness(BRIGHTNESS);

  // Clear LED strip
  FastLED.clear();
  FastLED.show();
}

float FPS = 15;                               // flashes per second [Hz]
uint32_t T_flash_update = round(1000. / FPS); // [ms]
uint32_t T_flash_length = 20;                 // [ms]

void loop() {
  EVERY_N_MILLISECONDS(T_flash_update) {
    FastLED.showColor(CRGB::White);
    FastLED.show();
    delay(T_flash_length);
    FastLED.showColor(CRGB::Black);
    FastLED.show();
  }
}
